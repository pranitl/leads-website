---
import Layout from '../../layouts/Layout.astro';
import LeadCaptureSection from '../../components/LeadCaptureSection.astro';
import { getCollection } from 'astro:content';
import { toLeadFormServiceOptions } from '../../lib/services';
import { orderLocationsByPriority } from '../../lib/locations';

const locationsCollection = await getCollection('locations');
const servicesCollection = await getCollection('services');

const orderedLocations = orderLocationsByPriority(locationsCollection);
const leadFormServices = toLeadFormServiceOptions(servicesCollection);

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'Service areas',
  url: `${Astro.url.origin}/locations`,
};
---

<Layout title="Locations | Austin Home Renovation Hub" description="Explore markets where our home renovation specialists are active." structuredData={structuredData}>
  <LeadCaptureSection
    services={leadFormServices}
    eyebrow="Service areas"
    title="Service areas we currently serve"
    description="Greater Austin is our home base. Explore the cities below to see how we help homeowners connect with trusted specialists. Don’t see your town? Share your zip in the form and we’ll notify you when we expand."
    formClassName="shadow-card"
  />
  <section class="container space-y-8 py-16">
    <div class="grid gap-5 md:grid-cols-3 lg:grid-cols-4">
      {orderedLocations.map((entry) => (
        <article class="rounded-2xl border border-neutral-200 bg-white/90 p-5 shadow-card">
          <p class="text-xs font-semibold uppercase tracking-wide text-brand-600">{entry.data.state}</p>
          <h2 class="mt-1 font-heading text-xl font-semibold text-neutral-900">{entry.data.city}</h2>
          <p class="mt-2 text-sm text-neutral-600">{entry.data.intro}</p>
          {entry.data.neighborhoods?.length ? (
            <p class="mt-4 text-xs uppercase tracking-wide text-neutral-500">
              Key neighborhoods: {entry.data.neighborhoods.join(', ')}
            </p>
          ) : null}
          <a class="mt-4 inline-flex items-center text-sm font-semibold text-brand-600 hover:text-brand-700" href={`/locations/${entry.data.slug}`}>
            Explore {entry.data.city}
            <svg viewBox="0 0 24 24" class="ml-1 h-4 w-4 fill-current" aria-hidden="true">
              <path d="M5 12a1 1 0 0 1 1-1h10.586l-3.293-3.293a1 1 0 0 1 1.414-1.414l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 1 1-1.414-1.414L16.586 13H6a1 1 0 0 1-1-1Z" />
            </svg>
          </a>
        </article>
      ))}
    </div>
  </section>
</Layout>
