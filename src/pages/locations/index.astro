---
import Layout from '../../layouts/Layout.astro';
import LeadCaptureSection from '../../components/LeadCaptureSection.astro';
import { getCollection } from 'astro:content';
import { toLeadFormServiceOptions } from '../../lib/services';
import { orderLocationsByPriority } from '../../lib/locations';

const locationsCollection = await getCollection('locations');
const servicesCollection = await getCollection('services');

const orderedLocations = orderLocationsByPriority(locationsCollection);
const leadFormServices = toLeadFormServiceOptions(servicesCollection);

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'Service areas',
  url: new URL('/locations', Astro.url).href,
};
---

<Layout title="Locations | Austin Home Renovation Hub" description="Explore markets where our home renovation specialists are active." structuredData={structuredData}>
  <LeadCaptureSection
    services={leadFormServices}
    eyebrow="Service areas"
    title="Service areas we currently serve"
    description="Greater Austin is our home base. Explore the cities below to see how we help homeowners connect with trusted specialists. Don't see your town? Share your zip in the form and we'll notify you when we expand."
  />
  <section class="container space-y-8 py-16">
    <div class="grid gap-5 md:grid-cols-3 lg:grid-cols-4">
      {orderedLocations.map((entry) => (
        <article class="group rounded-2xl border-2 border-brown-forest/20 bg-cream-light p-5 shadow-hard-light transition hover:-translate-x-0.5 hover:-translate-y-0.5 hover:shadow-hard-light-hover">
          <div class="flex items-center gap-2">
            <svg viewBox="0 0 24 24" class="h-4 w-4 fill-current text-oxide" aria-hidden="true">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
            <p class="text-xs font-semibold uppercase tracking-wide text-brown-forest">{entry.data.state}</p>
          </div>
          <h2 class="mt-2 font-heading text-xl font-semibold text-brown-dark">{entry.data.city}</h2>
          <p class="mt-2 text-sm text-brown-body">{entry.data.intro}</p>
          {entry.data.neighborhoods?.length ? (
            <div class="mt-4 flex flex-wrap gap-1">
              {entry.data.neighborhoods.slice(0, 3).map((neighborhood) => (
                <span class="rounded-full border border-brown-forest/20 bg-cream px-2 py-0.5 text-xs text-brown-muted">{neighborhood}</span>
              ))}
              {entry.data.neighborhoods.length > 3 && (
                <span class="rounded-full border border-brown-forest/20 bg-cream px-2 py-0.5 text-xs text-brown-muted">+{entry.data.neighborhoods.length - 3}</span>
              )}
            </div>
          ) : null}
          <a class="mt-4 inline-flex items-center text-sm font-semibold text-oxide hover:text-oxide-hover" href={`/locations/${entry.data.slug}`}>
            Explore {entry.data.city}
            <svg viewBox="0 0 24 24" class="ml-1 h-4 w-4 fill-current" aria-hidden="true">
              <path d="M5 12a1 1 0 0 1 1-1h10.586l-3.293-3.293a1 1 0 0 1 1.414-1.414l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 1 1-1.414-1.414L16.586 13H6a1 1 0 0 1-1-1Z" />
            </svg>
          </a>
        </article>
      ))}
    </div>
  </section>
</Layout>
