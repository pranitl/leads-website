---
import Layout from '../../layouts/Layout.astro';
import LeadCaptureSection from '../../components/LeadCaptureSection.astro';
import { getCollection } from 'astro:content';
import { toLeadFormServiceOptions } from '../../lib/services';

const servicesCollection = await getCollection('services');
const services = servicesCollection.map((entry) => ({
  ...entry.data,
}));
const leadFormServices = toLeadFormServiceOptions(servicesCollection);

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'Niche home services',
  url: `${Astro.url.origin}/services`,
};

const iconMap: Record<string, string> = {
  sprout: 'M12 2c4.418 0 8 3.582 8 8 0 3.523-2.292 6.5-5.5 7.567L14 22h-4l-.5-4.433C6.292 16.5 4 13.523 4 10c0-4.418 3.582-8 8-8Zm0 4a4 4 0 0 0-1 7.874V18h2v-4.126A4 4 0 0 0 12 6Z',
  layout: 'M4 4h16a2 2 0 0 1 2 2v3H2V6a2 2 0 0 1 2-2Zm-2 7h9v9H4a2 2 0 0 1-2-2v-7Zm11 0h9v7a2 2 0 0 1-2 2h-7v-9Z',
  stone: 'M12 3 4 8v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-8-5Zm0 2.236 6 3.75V16h-4v-3h-4v3H6V8.986l6-3.75ZM10 17h4v2h-4v-2Z',
};

const getIconPath = (identifier?: string) => {
  if (!identifier) return iconMap.sprout;
  return iconMap[identifier] ?? iconMap.sprout;
};
---

<Layout title="Services | Austin Home Renovation Hub" description="Explore home renovation services, then request curated specialists for your project." structuredData={structuredData}>
  <LeadCaptureSection
    services={leadFormServices}
    eyebrow="Our roster"
    title="Specialists curated for modern outdoor and interior projects"
    description="From drought-ready landscapes to space-saving closet builds, our network pairs you with artisans who understand sustainability, aesthetics, and precision installation."
  />

  <section class="container space-y-10 py-16">
    <div class="grid gap-6 md:grid-cols-2">
      {services.map((service) => (
        <article class="group rounded-2xl border-2 border-brown-forest/20 bg-cream-light p-6 shadow-hard-light transition hover:-translate-x-0.5 hover:-translate-y-0.5 hover:shadow-hard-light-hover">
          <div class="flex items-center gap-3">
            <span class="flex h-12 w-12 items-center justify-center rounded-full bg-brown-forest text-cream">
              <svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-current">
                <path d={getIconPath(service.icon)} />
              </svg>
            </span>
            <h2 class="font-heading text-2xl font-semibold text-brown-dark">{service.name}</h2>
          </div>
          <p class="mt-3 text-sm text-brown-body">{service.summary}</p>
          {service.benefits?.length ? (
            <ul class="mt-4 space-y-2 text-sm text-brown-body">
              {service.benefits.map((benefit) => (
                <li class="flex items-start gap-2">
                  <span class="mt-1 inline-block h-1.5 w-1.5 rounded-full bg-oxide"></span>
                  <span>{benefit}</span>
                </li>
              ))}
            </ul>
          ) : null}
          {service.subservices?.length ? (
            <div class="mt-5 space-y-2">
              <p class="text-xs font-semibold uppercase tracking-wide text-brown-muted">Included specialties</p>
              <div class="flex flex-wrap gap-2">
                {service.subservices.map((item) => (
                  <a class="rounded-full border border-brown-forest/30 bg-cream px-3 py-1 text-xs font-semibold text-brown-body transition hover:border-oxide hover:text-oxide" href={`/services/${service.slug}/${item.slug}`}>
                    {item.name}
                  </a>
                ))}
              </div>
            </div>
          ) : null}
          <a class="mt-6 inline-flex items-center text-sm font-semibold text-oxide hover:text-oxide-hover" href={`/services/${service.slug}`}>
            View service details
            <svg viewBox="0 0 24 24" class="ml-1 h-4 w-4 fill-current" aria-hidden="true">
              <path d="M5 12a1 1 0 0 1 1-1h10.586l-3.293-3.293a1 1 0 0 1 1.414-1.414l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 1 1-1.414-1.414L16.586 13H6a1 1 0 0 1-1-1Z" />
            </svg>
          </a>
        </article>
      ))}
    </div>
  </section>
</Layout>
