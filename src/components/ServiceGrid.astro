---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import landscapingIllustration from '../assets/images/placeholders/xeriscaping-landscape.webp';
import hardscapeIllustration from '../assets/images/placeholders/hardscape-retaining-wall.webp';
import closetIllustration from '../assets/images/placeholders/custom-closet-interior.webp';

type Service = {
  name: string;
  slug: string;
  summary: string;
  icon?: string;
  subservices?: { name: string; slug: string; summary?: string }[];
};

const { services = [] } = Astro.props as { services: Service[] };

const iconMap: Record<string, string> = {
  sprout:
    'M12 2c4.418 0 8 3.582 8 8 0 3.523-2.292 6.5-5.5 7.567L14 22h-4l-.5-4.433C6.292 16.5 4 13.523 4 10c0-4.418 3.582-8 8-8Zm0 4a4 4 0 0 0-1 7.874V18h2v-4.126A4 4 0 0 0 12 6Z',
  layout:
    'M4 4h16a2 2 0 0 1 2 2v3H2V6a2 2 0 0 1 2-2Zm-2 7h9v9H4a2 2 0 0 1-2-2v-7Zm11 0h9v7a2 2 0 0 1-2 2h-7v-9Z',
  stone:
    'M12 3 4 8v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-8-5Zm0 2.236 6 3.75V16h-4v-3h-4v3H6V8.986l6-3.75ZM10 17h4v2h-4v-2Z',
};

const getIconPath = (identifier?: string) => {
  if (!identifier) return iconMap.sprout;
  return iconMap[identifier] ?? iconMap.sprout;
};

const illustrationMap: Record<string, ImageMetadata> = {
  landscaping: landscapingIllustration,
  hardscaping: hardscapeIllustration,
  'closet-interior': closetIllustration,
};

const getIllustration = (slug: string) => illustrationMap[slug] ?? landscapingIllustration;
---

<section class="space-y-6 defer-visible">
  <div class="flex flex-col gap-3">
    <h2 class="font-heading text-3xl font-semibold text-brown-dark">Specialized services we offer</h2>
    <p class="max-w-2xl text-sm text-brown-body">
      Built for homeowners who want boutique craftsmanship without the guesswork. Start with a category and we will pinpoint the exact sub-specialist your project needs.
    </p>
  </div>
  <div class="grid gap-5 md:grid-cols-2">
    {services.map((service) => (
      <article class="group flex h-full flex-col gap-5 rounded-2xl border-2 border-brown-forest/20 bg-cream-light p-6 shadow-hard-light transition hover:-translate-x-0.5 hover:-translate-y-0.5 hover:shadow-hard-light-hover">
        <div class="space-y-4">
          <div class="flex items-center gap-3">
            <span class="flex h-12 w-12 items-center justify-center rounded-full bg-brown-forest text-cream">
              <svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-current">
                <path d={getIconPath(service.icon)} />
              </svg>
            </span>
            <div>
              <h3 class="font-heading text-xl font-semibold text-brown-dark">{service.name}</h3>
              <p class="text-sm text-brown-body">{service.summary}</p>
            </div>
          </div>
          <div class="overflow-hidden rounded-xl border-2 border-brown-forest/10 bg-cream">
            <Image
              src={getIllustration(service.slug)}
              alt={`${service.name} illustration`}
              widths={[320, 480, 640, 768]}
              sizes="(min-width: 768px) 45vw, 100vw"
              class="h-36 w-full object-cover"
              loading="lazy"
              decoding="async"
            />
          </div>
          {service.subservices?.length ? (
            <ul class="space-y-2 text-sm text-brown-body">
              {service.subservices.slice(0, 4).map((item) => (
                <li class="flex items-start gap-2">
                  <span class="mt-1 inline-block h-1.5 w-1.5 rounded-full bg-oxide"></span>
                  <div>
                    <p class="font-medium text-brown-dark">{item.name}</p>
                    {item.summary && <p class="text-xs text-brown-muted">{item.summary}</p>}
                  </div>
                </li>
              ))}
              {service.subservices.length > 4 && (
                <li class="text-xs font-semibold uppercase tracking-wide text-oxide">+ {service.subservices.length - 4} more specialties</li>
              )}
            </ul>
          ) : null}
        </div>
        <a class="mt-auto inline-flex items-center text-sm font-semibold text-oxide hover:text-oxide-hover" href={`/services/${service.slug}`}>
          Explore service
          <svg viewBox="0 0 24 24" class="ml-1 h-4 w-4 fill-current" aria-hidden="true">
            <path d="M13 5a1 1 0 1 1 2 0v8.586l2.293-2.293a1 1 0 1 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 1 1 1.414-1.414L13 13.586V5Z" />
          </svg>
        </a>
      </article>
    ))}
  </div>
</section>
